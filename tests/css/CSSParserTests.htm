<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>CSS Parser Tests</title>
<!-- Combo-handled YUI CSS files: -->
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?2.7.0/build/logger/assets/logger.css&2.7.0/build/yuitest/assets/testlogger.css">
<!-- Combo-handled YUI JS files: -->
<script type="text/javascript" src="http://yui.yahooapis.com/combo?2.7.0/build/yahoo-dom-event/yahoo-dom-event.js&2.7.0/build/logger/logger-min.js&2.7.0/build/yuitest/yuitest-min.js"></script>
<script type="text/javascript" src="../../build/parserlib.js"></script>


</head>
<body>
<h1>CSS Parser Tests</h1>
<script type="text/javascript">

YAHOO.namespace("test");

YAHOO.test.CSSParser = (function(){
    
    var assert = YAHOO.util.Assert,
        Selector = parserlib.css.Selector,
        Combinator = parserlib.css.Combinator,
        SelectorPart = parserlib.css.SelectorPart,
        Parser = parserlib.css.Parser;
    
    //-------------------------------------------------------------------------
    // Base Test Suite
    //-------------------------------------------------------------------------
    
    var suite = new YAHOO.tool.TestSuite("Selector Parsing");
   
    suite.add(new YAHOO.tool.TestCase({
    
        name: "Type Selector Tests",
        
        testSimpleTypeSelector: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].elementName, "Element name should be 'li'.");
            assert.areEqual(0, result.parts[0].modifiers, "Element should have zero modifiers.");
        },
        
        testSimpleTypeSelectorPlusNamespace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("svg|rect");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("svg|rect", result.parts[0].elementName, "Element name should be 'svg|rect'.");
            assert.areEqual(0, result.parts[0].modifiers, "Element should have zero modifiers.");
        },
        
        testSimpleTypeSelectorPlusBlankNamespace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("|rect");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("|rect", result.parts[0].elementName, "Element name should be '|rect'.");
            assert.areEqual(0, result.parts[0].modifiers, "Element should have zero modifiers.");
        },
        
        testSimpleTypeSelectorPlusUniversalNamespace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("*|rect");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("*|rect", result.parts[0].elementName, "Element name should be '*|rect'.");
            assert.areEqual(0, result.parts[0].modifiers, "Element should have zero modifiers.");
        }    
    }));
    
    suite.add(new YAHOO.tool.TestCase({
    
        name: "Universal Selector Tests",    
    
        testSimpleUniversalSelector: function(){
            var parser = new Parser();
            var result = parser.parseSelector("*");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("*", result.parts[0].elementName, "Element name should be '*'.");
            assert.areEqual(0, result.parts[0].modifiers.length, "Element should have zero modifiers.");
        },
        
        testSimpleUniversalSelectorPlusNamespace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("svg|*");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("svg|*", result.parts[0].elementName, "Element name should be 'svg|*'.");
            assert.areEqual(0, result.parts[0].modifiers.length, "Element should have zero modifiers.");
        },
        
        testSimpleUniversalSelectorPlusBlankNamespace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("|*");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("|*", result.parts[0].elementName, "Element name should be '|*'.");
            assert.areEqual(0, result.parts[0].modifiers.length, "Element should have zero modifiers.");
        },
        
        testSimpleUniversalSelectorPlusUniversalNamespace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("*|*");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("*|*", result.parts[0].elementName, "Element name should be '*|*'.");
            assert.areEqual(0, result.parts[0].modifiers.length, "Element should have zero modifiers.");
        }    
    
    }));

    suite.add(new YAHOO.tool.TestCase({
    
        name: "Attribute Selector Tests",    
    
        testAttributePresenceSelector: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li[class]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].elementName, "Element name should be 'li'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[class]", result.parts[0].modifiers[0].text, "Modifier text should be '[class]'.");
            
        },
        
        testAttributeEquivalenceSelector: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li[class=\"selected\"]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].elementName, "Element name should be 'li'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[class=\"selected\"]", result.parts[0].modifiers[0].text, "Modifier text should be '[class=\"selected\"]'.");
            
        },
        
        testAttributeEquivalenceSelectorNoString: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li[class=selected]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].elementName, "Element name should be 'li'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[class=selected]", result.parts[0].modifiers[0].text, "Modifier text should be '[class=selected]'.");
            
        },
        
        testAttributeContainsSelector: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li[class~=\"selected\"]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].elementName, "Element name should be 'li'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[class~=\"selected\"]", result.parts[0].modifiers[0].text, "Modifier text should be '[class~=\"selected\"]'.");
            
        },
        
        testAttributeDashMatchSelector: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li[class|=\"selected\"]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].elementName, "Element name should be 'li'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[class|=\"selected\"]", result.parts[0].modifiers[0].text, "Modifier text should be '[class|=\"selected\"]'.");
            
        },

        testAttributeStartMatchSelector: function(){
            var parser = new Parser();
            var result = parser.parseSelector("object[type^=\"image/\"]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("object", result.parts[0].elementName, "Element name should be 'object'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[type^=\"image/\"]", result.parts[0].modifiers[0].text, "Modifier text should be '[type^=\"image/\"]'.");            
        },

        testAttributeEndMatchSelector: function(){
            var parser = new Parser();
            var result = parser.parseSelector("a[href$=\".html\"]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("a", result.parts[0].elementName, "Element name should be 'a'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[href$=\".html\"]", result.parts[0].modifiers[0].text, "Modifier text should be '[href$=\".html\"]'.");            
        },

        testAttributeContainsMatchSelector: function(){
            var parser = new Parser();
            var result = parser.parseSelector("p[title*=\"hello\"]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("p", result.parts[0].elementName, "Element name should be 'p'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[title*=\"hello\"]", result.parts[0].modifiers[0].text, "Modifier text should be '[title*=\"hello\"]'.");            
        },

        testAttributeEquivalenceSelectorNamespace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li[html|class=selected]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].elementName, "Element name should be 'li'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[html|class=selected]", result.parts[0].modifiers[0].text, "Modifier text should be '[html|class=selected]'.");
            
        },
        
        testAttributeEquivalenceSelectorUniversalNamespace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li[*|class=selected]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].elementName, "Element name should be 'li'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[*|class=selected]", result.parts[0].modifiers[0].text, "Modifier text should be '[*|class=selected]'.");
            
        },
        
        testAttributeEquivalenceSelectorDefaultNamespace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li[|class=selected]");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(1, result.parts.length, "Selector should have three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].elementName, "Element name should be 'li'.");
            assert.areEqual(1, result.parts[0].modifiers.length, "Element should have one modifier.");
            assert.areEqual("attribute", result.parts[0].modifiers[0].type, "Modifier type should be 'attribute'.");
            assert.areEqual("[|class=selected]", result.parts[0].modifiers[0].text, "Modifier text should be '[|class=selected]'.");
            
        }
    }));


    suite.add(new YAHOO.tool.TestCase({
    
        name: "Combinators",
                
        testWithCombinator: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li.inline:hover > p");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.areEqual(3, result.parts.length, "Should be three parts.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.isInstanceOf(Combinator, result.parts[1], "Second part should be a Combinator.");
            assert.isInstanceOf(SelectorPart, result.parts[2], "Third part should be a SelectorPart.");            
        },
        
        testWithNthChild: function(){
            var parser = new Parser();
            var result = parser.parseSelector("tr:nth-child(2n+1) a");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.isInstanceOf(Combinator, result.parts[1], "Second part should be a Combinator.");
            assert.isInstanceOf(SelectorPart, result.parts[2], "Third part should be a SelectorPart.");
            assert.areEqual(3, result.parts.length, "Should be three parts.");
        
        }
    }));

    suite.add(new YAHOO.tool.TestCase({
    
        name: "Special Cases",
                
        testWithCommentAndSpaces: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li /*booya*/ p");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].toString(), "First part should be 'li'");
            assert.isInstanceOf(Combinator, result.parts[1], "Second part should be a Combinator.");
            assert.areEqual("descendant", result.parts[1].type, "Second part should be a 'descendant'");
            assert.isInstanceOf(SelectorPart, result.parts[2], "Third part should be a SelectorPart.");
            assert.areEqual("p", result.parts[2].toString(), "First part should be 'p'");
            assert.areEqual(3, result.parts.length, "Should be three parts.");            
        },
    
        testWithCommentAndTrailingSpace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li/*booya*/ p");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].toString(), "First part should be 'li'");
            assert.isInstanceOf(Combinator, result.parts[1], "Second part should be a Combinator.");
            assert.areEqual("descendant", result.parts[1].type, "Second part should be a 'descendant'");
            assert.isInstanceOf(SelectorPart, result.parts[2], "Third part should be a SelectorPart.");
            assert.areEqual("p", result.parts[2].toString(), "First part should be 'p'");
            assert.areEqual(3, result.parts.length, "Should be three parts.");            
        },
        
        testWithCommentAndLeadingSpace: function(){
            var parser = new Parser();
            var result = parser.parseSelector("li /*booya*/p");
            
            assert.isInstanceOf(Selector, result, "Result should be an instance of Selector.");
            assert.isInstanceOf(SelectorPart, result.parts[0], "First part should be a SelectorPart.");
            assert.areEqual("li", result.parts[0].toString(), "First part should be 'li'");
            assert.isInstanceOf(Combinator, result.parts[1], "Second part should be a Combinator.");
            assert.areEqual("descendant", result.parts[1].type, "Second part should be a 'descendant'");
            assert.isInstanceOf(SelectorPart, result.parts[2], "Third part should be a SelectorPart.");
            assert.areEqual("p", result.parts[2].toString(), "First part should be 'p'");
            assert.areEqual(3, result.parts.length, "Should be three parts.");            
        },
    
        testIEFilter: function(){
            var parser = new Parser({ieFilters:true});
            var result = parser.parseProperty("filter: progid:DXImageTransform.Microsoft.Wave(strength=100);");
            
            assert.isTrue(result);        
        },
        
        testIEFilter2: function(){
            var parser = new Parser({ieFilters:true});            
            var result = parser.parseProperty("filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, src=http://l.yimg.com/ne/home/metro/pa/map/gugimap_btn_mapview.png, sizingMethod=image);");
            
            assert.isTrue(result);
        
        },
        
        testIEFilter2: function(){
            var parser = new Parser({ieFilters:true});            
            var result = parser.parseProperty("filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', src='http://l.yimg.com/ne/home/metro/pa/map/gugimap_btn_mapview.png', sizingMethod='image');");
            
            assert.isTrue(result);
        
        }
        
        
    
        
    
    
    }));
    
    //return it
    return suite;

})();

(function (){
    //create the logger
    var logger = new YAHOO.tool.TestLogger();
    
    //add the tests
    YAHOO.tool.TestRunner.add(YAHOO.test.CSSParser);
    YAHOO.tool.TestRunner.run();

})();


</script>
</body>
</html>
